# Makefile automatically generated by GRHayL's configure script
PREFIX       = /usr/local
BUILDDIR     = build
LIBSOV       = libgrhayl_1.0.0.so
LIBSO        = libgrhayl.so
BUILDLIBSOV  = $(BUILDDIR)/lib/$(LIBSOV)
BUILDLIBSO   = $(BUILDDIR)/lib/$(LIBSO)
PREFIXLIBSOV = $(PREFIX)/lib/$(LIBSOV)
PREFIXLIBSO  = $(PREFIX)/lib/$(LIBSO)
CC           = gcc
CFLAGS       = -Wall -std=c99 -march=native -O2 -g -I/usr/include/hdf5/serial -DUSE_HDF5 -I./GRHayL/include
CCOMPILE     = $(CC) $(CFLAGS)
CCOMPILEOMP  = $(CC) $(CFLAGS) -fopenmp
LD_FLAGS     = -lm -L/usr/lib/x86_64-linux-gnu/hdf5/serial -lhdf5
SRC          = GRHayL/Con2Prim/apply_inequality_fixes.c GRHayL/Con2Prim/compute_conservs_and_Tmunu.c GRHayL/Con2Prim/enforce_primitive_limits_and_compute_u0.c GRHayL/Con2Prim/guess_primitives.c GRHayL/Con2Prim/initialize_diagnostics.c GRHayL/Con2Prim/limit_utilde_and_compute_v.c GRHayL/Con2Prim/reset_prims_to_atmosphere.c GRHayL/Con2Prim/undensitize_conservatives.c GRHayL/Con2Prim/C2P_Routines/Font_Fix/font_fix.c GRHayL/Con2Prim/C2P_Routines/Font_Fix/font_fix_hybrid_EOS.c GRHayL/Con2Prim/C2P_Routines/Font_Fix/font_fix_rhob_loop.c GRHayL/Con2Prim/C2P_Routines/Hybrid/func_vsq.c GRHayL/Con2Prim/C2P_Routines/Hybrid/GNR2D.c GRHayL/Con2Prim/C2P_Routines/Hybrid/Hybrid_Noble2D.c GRHayL/Con2Prim/C2P_Routines/Hybrid/Hybrid_Multi_Method.c GRHayL/Con2Prim/C2P_Routines/Tabulated/con2prim_Noble2D_Tab.c GRHayL/Con2Prim/C2P_Routines/Tabulated/Tabulated_CerdaDuran2D.c GRHayL/EOS/Hybrid/NRPyEOS_compute_entropy_function.c GRHayL/EOS/Hybrid/NRPyEOS_compute_P_cold_and_eps_cold.c GRHayL/EOS/Hybrid/NRPyEOS_compute_P_cold.c GRHayL/EOS/Hybrid/NRPyEOS_find_polytropic_index.c GRHayL/EOS/Hybrid/NRPyEOS_get_K_and_gamma.c GRHayL/EOS/Hybrid/NRPyEOS_hybrid_compute_enthalpy_and_cs2.c GRHayL/EOS/Hybrid/NRPyEOS_initialize_hybrid_functions.c GRHayL/EOS/Hybrid/NRPyEOS_set_K_ppoly_and_eps_integ_consts.c GRHayL/EOS/Tabulated/NRPyEOS_free_memory.c GRHayL/EOS/Tabulated/NRPyEOS_initialize_tabulated_functions.c GRHayL/EOS/Tabulated/NRPyEOS_tabulated_compute_enthalpy_and_cs2.c GRHayL/EOS/Tabulated/NRPyEOS_read_table_set_EOS_params.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_eps_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_eps_S_and_T_from_rho_Ye_P.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_from_rho_Ye_aux_find_T_and_interpolate_n_quantities.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_from_rho_Ye_T_interpolate_n_quantities.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_muhat_mue_mup_mun_Xn_and_Xp_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_and_eps_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_and_T_from_rho_Ye_eps.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_cs2_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_depsdT_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_S_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_T_from_rho_Ye_S.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_eps_muhat_mue_mup_and_mun_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_eps_S_and_cs2_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_from_rho_Ye_T.c GRHayL/EOS/Tabulated/interpolators/NRPyEOS_P_S_depsdT_and_T_from_rho_Ye_eps.c GRHayL/Flux_Source/calculate_characteristic_speed_dirn0.c GRHayL/Flux_Source/calculate_characteristic_speed_dirn1.c GRHayL/Flux_Source/calculate_characteristic_speed_dirn2.c GRHayL/Flux_Source/calculate_HLLE_fluxes_dirn0.c GRHayL/Flux_Source/calculate_HLLE_fluxes_dirn1.c GRHayL/Flux_Source/calculate_HLLE_fluxes_dirn2.c GRHayL/Flux_Source/calculate_source_terms_dirn0.c GRHayL/Flux_Source/calculate_source_terms_dirn1.c GRHayL/Flux_Source/calculate_source_terms_dirn2.c GRHayL/Flux_Source/calculate_tau_tilde_source_term_extrinsic_curv.c GRHayL/GRHayL_Core/compute_smallb_and_b2.c GRHayL/GRHayL_Core/compute_TDNmunu.c GRHayL/GRHayL_Core/compute_TUPmunu.c GRHayL/GRHayL_Core/enforce_detgij_and_initialize_metric.c GRHayL/GRHayL_Core/grhayl_info_warn_error.c GRHayL/GRHayL_Core/initialize_conservatives.c GRHayL/GRHayL_Core/initialize_eos.c GRHayL/GRHayL_Core/initialize_extrinsic_curvature.c GRHayL/GRHayL_Core/initialize_GRHayL.c GRHayL/GRHayL_Core/initialize_metric.c GRHayL/GRHayL_Core/initialize_primitives.c GRHayL/GRHayL_Core/initialize_stress_energy.c GRHayL/GRHayL_Core/limit_v_and_compute_u0.c GRHayL/GRHayL_Core/metric_helper.c GRHayL/GRHayL_Core/return_conservatives.c GRHayL/GRHayL_Core/return_primitives.c GRHayL/GRHayL_Core/return_stress_energy.c GRHayL/Induction/average.c GRHayL/Induction/calculate_phitilde_and_A_gauge_rhs.c GRHayL/Induction/HLL_flux.c GRHayL/Induction/interpolate_for_A_gauge_rhs.c GRHayL/Neutrinos/NRPyLeakage/NRPyLeakage_compute_neutrino_luminosities.c GRHayL/Neutrinos/NRPyLeakage/NRPyLeakage_compute_neutrino_opacities_and_GRMHD_source_terms.c GRHayL/Neutrinos/NRPyLeakage/NRPyLeakage_compute_neutrino_opacities.c GRHayL/Neutrinos/NRPyLeakage/NRPyLeakage_Fermi_Dirac_integrals.c GRHayL/Neutrinos/NRPyLeakage/NRPyLeakage_optical_depths_PathOfLeastResistance.c GRHayL/Reconstruction/compute_UrUl_onevar.c GRHayL/Reconstruction/flatten_and_monotonize_Ur_and_Ul.c GRHayL/Reconstruction/shock_detection_ftilde.c GRHayL/Reconstruction/simple_ppm.c GRHayL/Reconstruction/simple_ppm_no_rho_P.c GRHayL/Reconstruction/slope_limit.c GRHayL/Reconstruction/steepen_rhor_rhol.c
OBJ          = build/Con2Prim/apply_inequality_fixes.o build/Con2Prim/compute_conservs_and_Tmunu.o build/Con2Prim/enforce_primitive_limits_and_compute_u0.o build/Con2Prim/guess_primitives.o build/Con2Prim/initialize_diagnostics.o build/Con2Prim/limit_utilde_and_compute_v.o build/Con2Prim/reset_prims_to_atmosphere.o build/Con2Prim/undensitize_conservatives.o build/Con2Prim/C2P_Routines/Font_Fix/font_fix.o build/Con2Prim/C2P_Routines/Font_Fix/font_fix_hybrid_EOS.o build/Con2Prim/C2P_Routines/Font_Fix/font_fix_rhob_loop.o build/Con2Prim/C2P_Routines/Hybrid/func_vsq.o build/Con2Prim/C2P_Routines/Hybrid/GNR2D.o build/Con2Prim/C2P_Routines/Hybrid/Hybrid_Noble2D.o build/Con2Prim/C2P_Routines/Hybrid/Hybrid_Multi_Method.o build/Con2Prim/C2P_Routines/Tabulated/con2prim_Noble2D_Tab.o build/Con2Prim/C2P_Routines/Tabulated/Tabulated_CerdaDuran2D.o build/EOS/Hybrid/NRPyEOS_compute_entropy_function.o build/EOS/Hybrid/NRPyEOS_compute_P_cold_and_eps_cold.o build/EOS/Hybrid/NRPyEOS_compute_P_cold.o build/EOS/Hybrid/NRPyEOS_find_polytropic_index.o build/EOS/Hybrid/NRPyEOS_get_K_and_gamma.o build/EOS/Hybrid/NRPyEOS_hybrid_compute_enthalpy_and_cs2.o build/EOS/Hybrid/NRPyEOS_initialize_hybrid_functions.o build/EOS/Hybrid/NRPyEOS_set_K_ppoly_and_eps_integ_consts.o build/EOS/Tabulated/NRPyEOS_free_memory.o build/EOS/Tabulated/NRPyEOS_initialize_tabulated_functions.o build/EOS/Tabulated/NRPyEOS_tabulated_compute_enthalpy_and_cs2.o build/EOS/Tabulated/NRPyEOS_read_table_set_EOS_params.o build/EOS/Tabulated/interpolators/NRPyEOS_eps_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_eps_S_and_T_from_rho_Ye_P.o build/EOS/Tabulated/interpolators/NRPyEOS_from_rho_Ye_aux_find_T_and_interpolate_n_quantities.o build/EOS/Tabulated/interpolators/NRPyEOS_from_rho_Ye_T_interpolate_n_quantities.o build/EOS/Tabulated/interpolators/NRPyEOS_muhat_mue_mup_mun_Xn_and_Xp_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_and_eps_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_and_T_from_rho_Ye_eps.o build/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_cs2_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_depsdT_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_S_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_eps_and_T_from_rho_Ye_S.o build/EOS/Tabulated/interpolators/NRPyEOS_P_eps_muhat_mue_mup_and_mun_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_eps_S_and_cs2_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_from_rho_Ye_T.o build/EOS/Tabulated/interpolators/NRPyEOS_P_S_depsdT_and_T_from_rho_Ye_eps.o build/Flux_Source/calculate_characteristic_speed_dirn0.o build/Flux_Source/calculate_characteristic_speed_dirn1.o build/Flux_Source/calculate_characteristic_speed_dirn2.o build/Flux_Source/calculate_HLLE_fluxes_dirn0.o build/Flux_Source/calculate_HLLE_fluxes_dirn1.o build/Flux_Source/calculate_HLLE_fluxes_dirn2.o build/Flux_Source/calculate_source_terms_dirn0.o build/Flux_Source/calculate_source_terms_dirn1.o build/Flux_Source/calculate_source_terms_dirn2.o build/Flux_Source/calculate_tau_tilde_source_term_extrinsic_curv.o build/GRHayL_Core/compute_smallb_and_b2.o build/GRHayL_Core/compute_TDNmunu.o build/GRHayL_Core/compute_TUPmunu.o build/GRHayL_Core/enforce_detgij_and_initialize_metric.o build/GRHayL_Core/grhayl_info_warn_error.o build/GRHayL_Core/initialize_conservatives.o build/GRHayL_Core/initialize_eos.o build/GRHayL_Core/initialize_extrinsic_curvature.o build/GRHayL_Core/initialize_GRHayL.o build/GRHayL_Core/initialize_metric.o build/GRHayL_Core/initialize_primitives.o build/GRHayL_Core/initialize_stress_energy.o build/GRHayL_Core/limit_v_and_compute_u0.o build/GRHayL_Core/metric_helper.o build/GRHayL_Core/return_conservatives.o build/GRHayL_Core/return_primitives.o build/GRHayL_Core/return_stress_energy.o build/Induction/average.o build/Induction/calculate_phitilde_and_A_gauge_rhs.o build/Induction/HLL_flux.o build/Induction/interpolate_for_A_gauge_rhs.o build/Neutrinos/NRPyLeakage/NRPyLeakage_compute_neutrino_luminosities.o build/Neutrinos/NRPyLeakage/NRPyLeakage_compute_neutrino_opacities_and_GRMHD_source_terms.o build/Neutrinos/NRPyLeakage/NRPyLeakage_compute_neutrino_opacities.o build/Neutrinos/NRPyLeakage/NRPyLeakage_Fermi_Dirac_integrals.o build/Neutrinos/NRPyLeakage/NRPyLeakage_optical_depths_PathOfLeastResistance.o build/Reconstruction/compute_UrUl_onevar.o build/Reconstruction/flatten_and_monotonize_Ur_and_Ul.o build/Reconstruction/shock_detection_ftilde.o build/Reconstruction/simple_ppm.o build/Reconstruction/simple_ppm_no_rho_P.o build/Reconstruction/slope_limit.o build/Reconstruction/steepen_rhor_rhol.o
INCS         = GRHayL/Con2Prim/C2P_Routines/harm_u2p_util.h
IHDS         = GRHayL/include/con2prim.h GRHayL/include/flux_source.h GRHayL/include/GRHayL.h GRHayL/include/GRHayL_io.h GRHayL/include/induction.h GRHayL/include/Neutrinos.h GRHayL/include/NRPyEOS_Hybrid.h GRHayL/include/NRPyEOS_Tabulated.h GRHayL/include/NRPyLeakage.h GRHayL/include/reconstruction.h GRHayL/include/unit_tests.h
INC         := $(INCS) $(IHDS)
LIBS         = $(BUILDLIBSO)
TEXES    = test/unit_test_ET_Legacy_HLL_flux test/unit_test_ET_Legacy_flux_source test/unit_test_apply_inequality_fixes test/unit_test_ET_Legacy_primitives test/unit_test_ET_Legacy_reconstruction test/unit_test_font_fix test/unit_test_ET_Legacy_induction_gauge_rhs test/unit_test_Noble2D_Hybrid_Multi_Method test/unit_test_ET_Legacy_conservs test/unit_test_data_ET_Legacy_induction_gauge_rhs test/unit_test_compute_conservs_and_Tmunu test/unit_test_enforce_primitive_limits_and_compute_u0 test/unit_test_tabulated_eos
TOBJS    = build/Unit_Tests/validate_stress_energy.o build/Unit_Tests/io_primitive_binary.o build/Unit_Tests/io_conservative_binary.o build/Unit_Tests/io_metric_binary.o build/Unit_Tests/io_stress_energy_binary.o build/Unit_Tests/validate_conservatives.o build/Unit_Tests/randomize_primitives.o build/Unit_Tests/tabulated_eos_unit_test_helpers.o build/Unit_Tests/validate_primitives.o build/Unit_Tests/randomize_metric.o 
TEXEOBJS = build/Unit_Tests/unit_test_ET_Legacy_HLL_flux.o build/Unit_Tests/unit_test_ET_Legacy_flux_source.o build/Unit_Tests/unit_test_apply_inequality_fixes.o build/Unit_Tests/unit_test_ET_Legacy_primitives.o build/Unit_Tests/unit_test_ET_Legacy_reconstruction.o build/Unit_Tests/unit_test_font_fix.o build/Unit_Tests/unit_test_ET_Legacy_induction_gauge_rhs.o build/Unit_Tests/unit_test_Noble2D_Hybrid_Multi_Method.o build/Unit_Tests/unit_test_ET_Legacy_conservs.o build/Unit_Tests/unit_test_data_ET_Legacy_induction_gauge_rhs.o build/Unit_Tests/unit_test_compute_conservs_and_Tmunu.o build/Unit_Tests/unit_test_enforce_primitive_limits_and_compute_u0.o build/Unit_Tests/unit_test_tabulated_eos.o


all: grhayl tests
	@echo "All done!"

grhayl: $(LIBS)

tests: $(TEXES)

$(BUILDLIBSO): $(BUILDLIBSOV)
	rm -f $(BUILDLIBSO) && ln -s $(LIBSOV) $(BUILDLIBSO)

$(BUILDLIBSOV): $(OBJ)
	$(CCOMPILE) -fPIC -shared $(OBJ) -o $@ $(LD_FLAGS)

$(OBJ): $(BUILDDIR)/%.o : GRHayL/%.c $(INC)
	$(CCOMPILE) -fPIC -c $< -o $@

clean:
	rm -f $(OBJ) $(TEXES) $(TOBJS) $(BUILDLIBSO) $(BUILDLIBSOV)
realclean: clean
	rm -rf $(BUILDDIR)
	rm -f Makefile

$(TEXES): test/%: $(BUILDDIR)/Unit_Tests/%.o $(TOBJS) $(LIBS)
	$(CCOMPILEOMP) $(TOBJS) $< -o $@ $(LD_FLAGS) -L$(BUILDDIR)/lib -lgrhayl

$(TOBJS): $(BUILDDIR)/%.o: %.c
	$(CCOMPILEOMP) -c $< -o $@

$(TEXEOBJS): $(BUILDDIR)/%.o: %.c
	$(CCOMPILEOMP) -c $< -o $@

install: grhayl
	@echo "Installing GRHayL in $(PREFIX)..."
	@echo "Installing GRHayL headers in $(PREFIX)/include/grhayl"
	@mkdir -p $(PREFIX)/include/grhayl
	@cp $(IHDS) $(PREFIX)/include/grhayl
	@echo "Installing GRHayL libraries in $(PREFIX)/lib"
	@mkdir -p $(PREFIX)/lib
	@cp -a $(BUILDDIR)/lib/* $(PREFIX)/lib

uninstall:
	@echo "Uninstalling GRHayL from $(PREFIX)..."
	@echo "Uninstalling GRHayL headers from $(PREFIX)/include/grhayl"
	@rm -rf $(PREFIX)/include/grhayl
	@echo "Uninstalling GRHayL libraries from $(PREFIX)/lib"
	@rm -rf $(PREFIXLIBSO) $(PREFIXLIBSOV)

