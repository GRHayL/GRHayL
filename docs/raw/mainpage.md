# GRHayL

---

The General Relativistic Hydrodynamic Library (@grhayl) is an infrastructure-agnostic
magnetohydrodynamics code library designed for modular development of GRMHD code.
The library is divided into independent modules, or "gems", which provide various
features needed for GRMHD simulations.

The core @grhayl "chalice" provides core connective tissue in the form of C structs
and very simple functions that act only on these structs. Adding onto [GRHayL_Core](@ref GRHayL_Core) are
several gems which provide specific features. These currently include

- @ref Atmosphere
- @ref Con2Prim
- @ref EOS
- @ref Flux_Source
- @ref Induction
- @ref Neutrinos
- @ref Reconstruction

Each gem implements infrastructure-agnostic functions for computing quantities for
GRMHD simulations.

## Building and Installing GRHayL

@grhayl includes a \c configure script which sets up a Makefile. For a full list of options,
use the `-h` option for a list of all compilation flags.

### Dependencies

@grhayl contains an optional HDF5 dependency, and the default configuration builds with `HDF5`
active. To compile without `HDF5` use the `--nohdf5` flag. To compile `HDF5` on your local machine
use the command

```shell
$ sudo apt-get install libhdf5-serial-dev
```

@grhayl is also actively tested on MacOS using the [Homebrew](https://brew.sh/)
package manager. To install `HDF5` on MacOS we recommend using

```shell
$ brew install hdf5
```

We have not tested @grhayl with [macports](https://www.macports.org/), although
we do not expect users to have issues when using it.

The `HDF5` dependency arises from the tabulated equation of state implementation, as
it currently only supports EOS tables in that format. We are also
working supporting tables in the [CompOSE](https://compose.obspm.fr/table)
format, which would allow for use of the tabulated EOS without `HDF5`.

### System-wide Installation (default)

As an example, suppose you wish to install @grhayl on your system using
`gcc`. To do so, run the following commands:

```shell
$ CC=gcc ./configure
$ make
$ make install
```

### Local Installation

As an example, a local installation that uses the next-generation intel
compilers is achieved as follows:

```shell
$ CC=icx ./configure --prefix=<local_path>
$ make
$ make install
```

## CI Testing

@grhayl uses Github Actions to perform continuous integration (CI) testing for validating the code.
The Unit_Tests directory contains the unit tests which are used for the CI. The subdirectory
"data_gen" contains the functions for generating the test data. The actual test data is kept in
the [Test_Data](https://github.com/GRHayL/Test_Data) repository. Tests with "ET_Legacy" in the name
only generate input data, as the output is generated from the `GRHayLTestPatch` branch of `IllinoisGRMHD`
in the `Einstein Toolkit` for validation with the old code. All the tests function by generating
output data and perturbed output data. The perturbed data is generated by perturbing the input data by

\f[
\mathrm{input}_\mathrm{pert} = \mathrm{input} \times (1 + \mathrm{rand}(0,1) \times 10^{-14})
\f]

This output serves as error bars for the functions, and the tests validate that the computed output falls
within this range.

## Implementations

Most codes will simply link to the compiled library. However, some infrastructures (such as
the `Einstein Toolkit`) interface with the library more easily by directly compiling the code.
The implementations directory contains specific implementations of @grhayl in infrastructures
that prefer this method of interfacing with @grhayl.
